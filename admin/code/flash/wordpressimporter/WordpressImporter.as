package {     import flash.display.Sprite;     import flash.events.*;      import flash.net.FileFilter;     import flash.net.FileReference;     import flash.net.URLRequest;     import flash.utils.ByteArray; 	import flash.external.ExternalInterface;	import WordpressXMLReader;	    public class WordpressImporter extends Sprite     {         private var fileRef:FileReference; 		        public function WordpressImporter()         { 			if (ExternalInterface.available){				ExternalInterface.call('WordpressImporter.onMessage','LocalFileReader...');			}			            fileRef = new FileReference();             fileRef.addEventListener(Event.SELECT, onFileSelected);             fileRef.addEventListener(Event.CANCEL, onCancel);             fileRef.addEventListener(IOErrorEvent.IO_ERROR, onIOError);             fileRef.addEventListener(SecurityErrorEvent.SECURITY_ERROR, onSecurityError);             var textTypeFilter:FileFilter = new FileFilter("WordPress eXtended RSS (WXR) file (*.xml)", "*.xml"); 						if (ExternalInterface.available){				ExternalInterface.call('WordpressImporter.onMessage','Calling browse...');			}			else {				trace('Calling browse...');			}        			try {				fileRef.browse([textTypeFilter]); 			} 			catch (error:SecurityError) {				if (ExternalInterface.available){					ExternalInterface.call('WordpressImporter.onError','Security error...'+error.toString());				}				else {					trace(error.toString());				}			} 			catch (error:Error) {				if (ExternalInterface.available){					ExternalInterface.call('WordpressImporter.onError','Error...'+error.toString());				}				else {					trace(error.toString());				}			}				        } 		        public function onFileSelected(evt:Event):void         {             fileRef.addEventListener(ProgressEvent.PROGRESS, onProgress);             fileRef.addEventListener(Event.COMPLETE, onComplete); 			if (ExternalInterface.available){				ExternalInterface.call("WordpressImporter.onFileSelected", fileRef.name, fileRef.size, fileRef.type);							}            fileRef.load();         }          public function onProgress(evt:ProgressEvent):void         {             //trace("Loaded " + evt.bytesLoaded + " of " + evt.bytesTotal + " bytes."); 			if (ExternalInterface.available){				ExternalInterface.call("WordpressImporter.onProgress", evt.bytesLoaded, evt.bytesTotal);			}			else {				trace('Progress ' + evt.bytesLoaded + ' / ' + evt.bytesTotal + ' bytes');			}        }          public function onComplete(evt:Event):void         {             //trace("File was successfully loaded.");             //trace(fileRef.data); 			// Get the data from the file as a ByteArray			var data:ByteArray = fileRef.data;						//ExternalInterface.call("WordpressImporter.onLoaded", data.readUTFBytes(data.bytesAvailable));			// Parse channel data			var reader = new WordpressXMLReader();			reader.process(data.readUTFBytes(data.bytesAvailable));        }          public function onCancel(evt:Event):void         {             //trace("The browse request was canceled by the user.");         }          public function onIOError(evt:IOErrorEvent):void         { 			if (ExternalInterface.available){				ExternalInterface.call("WordpressImporter.onError", "There was an IO Error.");			}			else {				trace('There was an IO Error');			}        }		        public function onSecurityError(evt:Event):void         { 			if (ExternalInterface.available){				ExternalInterface.call("WordpressImporter.onError", "There was a security error.");			}			else {            	trace("There was a security error.");							}        }     } }